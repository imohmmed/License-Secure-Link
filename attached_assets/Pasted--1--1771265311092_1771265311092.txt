� فكرة نظام الترخيص المطلوب

أريد بناء نظام ترخيص مركزي يعمل كالتالي:

1️⃣ الفكرة العامة

يوجد:
 • سيرفر خارجي عندي (License Authority)
 • سيرفر عميل أقوم أنا بالدخول إليه عبر SSH بصلاحية root

الهدف هو:
 • عند تثبيت النظام لأول مرة على سيرفر العميل
 • يتم أخذ بصمة الجهاز (HWID)
 • إرسالها عبر HTTPS إلى سيرفري الخارجي
 • هناك يتم إنشاء رخصة مرتبطة حصرياً بهذا الجهاز
 • يتم توقيع الرخصة رقمياً
 • ثم إرجاعها إلى سيرفر العميل وتثبيتها
 • بعدها لا يعمل النظام إلا إذا كانت الرخصة صحيحة

⸻

2️⃣ طريقة العمل بالتفصيل

المرحلة الأولى: التفعيل الأولي (Provisioning)
 1. أدخل أنا إلى سيرفر العميل عبر SSH.
 2. أشغّل سكربت provision.sh.
 3. السكربت:
 • يجمع معلومات الجهاز (machine-id + UUID + MAC).
 • ينشئ HWID hash.
 • يرسل هذا الـ hash إلى السيرفر الخارجي عبر HTTPS فقط.
 4. السيرفر الخارجي:
 • ينشئ License ID جديد.
 • يربط الرخصة بـ HWID.
 • يحدد عدد المستخدمين وتاريخ الانتهاء.
 • يبني بيانات الرخصة.
 • يوقعها باستخدام Private Key (RSA).
 • يرجع للعميل:
 • license data
 • digital signature
 5. سكربت العميل:
 • يحفظ الرخصة والتوقيع محلياً.
 • يزرع public key للتحقق.
 • يثبت خدمة تحقق تعمل تلقائياً.

⸻

3️⃣ آلية الحماية
 • لا يتم إنشاء أي رخصة داخل جهاز العميل.
 • كل التوقيع يتم في السيرفر الخارجي فقط.
 • جهاز العميل يحتوي فقط على public key للتحقق.
 • إذا تم نسخ الرخصة إلى جهاز آخر:
 • سيتغير HWID.
 • التحقق سيفشل.
 • النظام لن يعمل.

⸻

4️⃣ التحقق الدوري

يجب أن:
 • يقوم سيرفر العميل بالتحقق من الرخصة بشكل دوري (مثلاً كل 6 ساعات).
 • يتصل عبر HTTPS إلى السيرفر الخارجي.
 • يرسل license_id + hwid.
 • السيرفر يتحقق من الحالة (active / expired / suspended).
 • إذا تم إيقاف الرخصة من لوحة التحكم → يتوقف النظام في العميل.

⸻

5️⃣ لوحة التحكم في السيرفر الخارجي

يجب أن تحتوي على:
 • إنشاء رخص جديدة.
 • تعديل عدد المستخدمين.
 • تعديل تاريخ الانتهاء.
 • إيقاف الرخصة.
 • عرض آخر اتصال لكل عميل.
 • عرض سجلات العمليات.

أي تعديل يتم من اللوحة يجب أن يؤثر مباشرة في التحقق القادم من العميل.

⸻

6️⃣ متطلبات الأمان
 • الاتصال عبر HTTPS فقط.
 • استخدام توقيع رقمي RSA.
 • عدم تخزين private key خارج السيرفر الخارجي.
 • ربط الرخصة ببصمة الجهاز.
 • عدم السماح بعمل النظام بدون تحقق ناجح.
 • تسجيل كل عمليات التحقق في قاعدة البيانات.

⸻

7️⃣ الهدف النهائي
 • الرخصة مربوطة حصرياً بجهاز معين.
 • لا يمكن نسخها لجهاز آخر.
 • لا يمكن إنشاء رخصة بدون السيرفر الخارجي.
 • يمكنني التحكم الكامل عن بعد.
 • أي تعطيل أو انتهاء صلاحية يوقف الن